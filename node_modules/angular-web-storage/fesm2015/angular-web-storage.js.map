{"version":3,"sources":["v:/jad-admin-go/mazat_admin_panel/node_modules/angular-web-storage/fesm2015/angular-web-storage.js"],"names":[],"mappings":"AAAA;;;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;yDAkKC;;kCAEiC,AACK;;;;;;;;;;;;yDAOtC;;oCAEmC,AACG","file":"angular-web-storage.js","sourcesContent":["import { defineInjectable, Injectable, NgModule } from '@angular/core';\r\n\r\n/**\r\n * 判断是否在浏览器中渲染Angular应用\r\n * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识\r\n * 这带来的好处是当服务端自行填充 Document 时也能很好的识别\r\n */\r\nconst isBrowser = typeof document === 'object' && !!document;\r\nclass StorageUtil {\r\n    static get(storage, key) {\r\n        if (storage == null) {\r\n            return null;\r\n        }\r\n        const value = StorageUtil.parse(storage.getItem(key) || 'null') || null;\r\n        if (value === null)\r\n            return null;\r\n        if (typeof value === 'object' &&\r\n            typeof value._expired !== 'undefined' &&\r\n            value._expired !== 0 &&\r\n            +new Date() > value._expired) {\r\n            StorageUtil.remove(storage, key);\r\n            return null;\r\n        }\r\n        return value._value || null;\r\n    }\r\n    static set(storage, key, value, expiredAt = 0, expiredUnit = 't') {\r\n        if (storage == null) {\r\n            return;\r\n        }\r\n        storage.setItem(key, StorageUtil.stringify({\r\n            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),\r\n            _value: value,\r\n        }));\r\n    }\r\n    static remove(storage, key) {\r\n        if (storage == null) {\r\n            return;\r\n        }\r\n        storage.removeItem(key);\r\n    }\r\n    static key(storage, index) {\r\n        return storage == null ? '' : storage.key(index);\r\n    }\r\n    static getExpired(val, unit) {\r\n        if (val <= 0)\r\n            return 0;\r\n        const now = +new Date();\r\n        switch (unit) {\r\n            case 's': // 秒\r\n                return now + 1000 * val;\r\n            case 'm': // 分\r\n                return now + 1000 * 60 * val;\r\n            case 'h': // 时\r\n                return now + 1000 * 60 * 60 * val;\r\n            case 'd': // 天\r\n                return now + 1000 * 60 * 60 * 24 * val;\r\n            case 'w': // 周\r\n                return now + 1000 * 60 * 60 * 24 * 7 * val;\r\n            case 'y': // 年\r\n                return now + 1000 * 60 * 60 * 24 * 365 * val;\r\n            case 't': // 自定义\r\n                return now + val;\r\n        }\r\n        return 0;\r\n    }\r\n    static stringify(value) {\r\n        return JSON.stringify(value);\r\n    }\r\n    static parse(text) {\r\n        try {\r\n            return JSON.parse(text) || null;\r\n        }\r\n        catch (e) {\r\n            return text;\r\n        }\r\n    }\r\n}\r\n\r\nconst cache = {};\r\nfunction WebStorage(storage, key, expiredAt = 0, expiredUnit = 'd') {\r\n    return (target, propertyName) => {\r\n        key = key || propertyName;\r\n        Object.defineProperty(target, propertyName, {\r\n            get: () => {\r\n                return StorageUtil.get(storage, key);\r\n            },\r\n            set: (value) => {\r\n                if (!cache[key]) {\r\n                    const storedValue = StorageUtil.get(storage, key);\r\n                    if (storedValue === null) {\r\n                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);\r\n                    }\r\n                    cache[key] = true;\r\n                    return;\r\n                }\r\n                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);\r\n            },\r\n            enumerable: true,\r\n            configurable: true,\r\n        });\r\n    };\r\n}\r\n/**\r\n * `localStorage` Decorator\r\n *\r\n * @param [expiredAt=0] Expiration time, 0 means forever\r\n * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])\r\n */\r\nfunction LocalStorage(key, expiredAt = 0, expiredUnit = 't') {\r\n    return WebStorage(isBrowser ? localStorage : null, key, expiredAt, expiredUnit);\r\n}\r\n/**\r\n * `sessionStorage` Decorator\r\n *\r\n * @param [expiredAt=0] Expiration time, 0 means forever\r\n * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])\r\n */\r\nfunction SessionStorage(key, expiredAt = 0, expiredUnit = 't') {\r\n    return WebStorage(isBrowser ? sessionStorage : null, key, expiredAt, expiredUnit);\r\n}\r\n\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nclass StorageService {\r\n    constructor(storage) {\r\n        this.storage = storage;\r\n    }\r\n    get(key) {\r\n        return StorageUtil.get(this.storage, key);\r\n    }\r\n    set(key, value, expiredAt = 0, expiredUnit = 'd') {\r\n        return StorageUtil.set(this.storage, key, value, expiredAt, expiredUnit);\r\n    }\r\n    /**\r\n     * 删除指定key，如：\r\n     * - `remove('key')` 删除 `key` 键\r\n     * - `remove(/BMap_\\w+/)` 批量删除所有 BMap_ 开头的键\r\n     * @param key 键名或正则表达式\r\n     */\r\n    remove(key) {\r\n        if (typeof key === 'string') {\r\n            StorageUtil.remove(this.storage, key);\r\n            return;\r\n        }\r\n        let index = 0;\r\n        let next = StorageUtil.key(this.storage, index);\r\n        const ls = [];\r\n        while (next) {\r\n            if (key.test(next))\r\n                ls.push(next);\r\n            next = StorageUtil.key(this.storage, ++index);\r\n        }\r\n        ls.forEach(v => StorageUtil.remove(this.storage, v));\r\n    }\r\n    clear() {\r\n        this.storage.clear();\r\n    }\r\n}\r\nlet LocalStorageService = class LocalStorageService extends StorageService {\r\n    constructor() {\r\n        super(isBrowser ? localStorage : null);\r\n    }\r\n};\r\nLocalStorageService.ngInjectableDef = defineInjectable({ factory: function LocalStorageService_Factory() { return new LocalStorageService(); }, token: LocalStorageService, providedIn: \"root\" });\r\nLocalStorageService = __decorate([\r\n    Injectable({ providedIn: 'root' }),\r\n    __metadata(\"design:paramtypes\", [])\r\n], LocalStorageService);\r\nlet SessionStorageService = class SessionStorageService extends StorageService {\r\n    constructor() {\r\n        super(isBrowser ? sessionStorage : null);\r\n    }\r\n};\r\nSessionStorageService.ngInjectableDef = defineInjectable({ factory: function SessionStorageService_Factory() { return new SessionStorageService(); }, token: SessionStorageService, providedIn: \"root\" });\r\nSessionStorageService = __decorate([\r\n    Injectable({ providedIn: 'root' }),\r\n    __metadata(\"design:paramtypes\", [])\r\n], SessionStorageService);\r\n\r\nvar __decorate$1 = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nlet AngularWebStorageModule = class AngularWebStorageModule {\r\n};\r\nAngularWebStorageModule = __decorate$1([\r\n    NgModule()\r\n], AngularWebStorageModule);\r\n\r\n/**\r\n * Generated bundle index. Do not edit.\r\n */\r\n\r\nexport { AngularWebStorageModule, LocalStorage, LocalStorageService, SessionStorage, SessionStorageService, StorageService };\r\n\r\n"]}