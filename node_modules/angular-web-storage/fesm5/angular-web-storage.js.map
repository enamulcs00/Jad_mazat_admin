{"version":3,"sources":["v:/jad-admin-go/mazat_admin_panel/node_modules/angular-web-storage/fesm5/angular-web-storage.js"],"names":[],"mappings":"AAAA;;;;;;;;AAOA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;sCAgMsC,AACK;;;;;;;0CAEf;;;;;;;;;wCASY,AACG;;;;;;;0CAEb","file":"angular-web-storage.js","sourcesContent":["import { defineInjectable, Injectable, NgModule } from '@angular/core';\r\n\r\n/**\r\n * 判断是否在浏览器中渲染Angular应用\r\n * `decorator` 无法直接使用Angular `PLATFORM_ID` 标识\r\n * 这带来的好处是当服务端自行填充 Document 时也能很好的识别\r\n */\r\nvar isBrowser = typeof document === 'object' && !!document;\r\nvar StorageUtil = /** @class */ (function () {\r\n    function StorageUtil() {\r\n    }\r\n    StorageUtil.get = function (storage, key) {\r\n        if (storage == null) {\r\n            return null;\r\n        }\r\n        var value = StorageUtil.parse(storage.getItem(key) || 'null') || null;\r\n        if (value === null)\r\n            return null;\r\n        if (typeof value === 'object' &&\r\n            typeof value._expired !== 'undefined' &&\r\n            value._expired !== 0 &&\r\n            +new Date() > value._expired) {\r\n            StorageUtil.remove(storage, key);\r\n            return null;\r\n        }\r\n        return value._value || null;\r\n    };\r\n    StorageUtil.set = function (storage, key, value, expiredAt, expiredUnit) {\r\n        if (expiredAt === void 0) { expiredAt = 0; }\r\n        if (expiredUnit === void 0) { expiredUnit = 't'; }\r\n        if (storage == null) {\r\n            return;\r\n        }\r\n        storage.setItem(key, StorageUtil.stringify({\r\n            _expired: StorageUtil.getExpired(expiredAt, expiredUnit),\r\n            _value: value,\r\n        }));\r\n    };\r\n    StorageUtil.remove = function (storage, key) {\r\n        if (storage == null) {\r\n            return;\r\n        }\r\n        storage.removeItem(key);\r\n    };\r\n    StorageUtil.key = function (storage, index) {\r\n        return storage == null ? '' : storage.key(index);\r\n    };\r\n    StorageUtil.getExpired = function (val, unit) {\r\n        if (val <= 0)\r\n            return 0;\r\n        var now = +new Date();\r\n        switch (unit) {\r\n            case 's': // 秒\r\n                return now + 1000 * val;\r\n            case 'm': // 分\r\n                return now + 1000 * 60 * val;\r\n            case 'h': // 时\r\n                return now + 1000 * 60 * 60 * val;\r\n            case 'd': // 天\r\n                return now + 1000 * 60 * 60 * 24 * val;\r\n            case 'w': // 周\r\n                return now + 1000 * 60 * 60 * 24 * 7 * val;\r\n            case 'y': // 年\r\n                return now + 1000 * 60 * 60 * 24 * 365 * val;\r\n            case 't': // 自定义\r\n                return now + val;\r\n        }\r\n        return 0;\r\n    };\r\n    StorageUtil.stringify = function (value) {\r\n        return JSON.stringify(value);\r\n    };\r\n    StorageUtil.parse = function (text) {\r\n        try {\r\n            return JSON.parse(text) || null;\r\n        }\r\n        catch (e) {\r\n            return text;\r\n        }\r\n    };\r\n    return StorageUtil;\r\n}());\r\n\r\nvar cache = {};\r\nfunction WebStorage(storage, key, expiredAt, expiredUnit) {\r\n    if (expiredAt === void 0) { expiredAt = 0; }\r\n    if (expiredUnit === void 0) { expiredUnit = 'd'; }\r\n    return function (target, propertyName) {\r\n        key = key || propertyName;\r\n        Object.defineProperty(target, propertyName, {\r\n            get: function () {\r\n                return StorageUtil.get(storage, key);\r\n            },\r\n            set: function (value) {\r\n                if (!cache[key]) {\r\n                    var storedValue = StorageUtil.get(storage, key);\r\n                    if (storedValue === null) {\r\n                        StorageUtil.set(storage, key, value, expiredAt, expiredUnit);\r\n                    }\r\n                    cache[key] = true;\r\n                    return;\r\n                }\r\n                StorageUtil.set(storage, key, value, expiredAt, expiredUnit);\r\n            },\r\n            enumerable: true,\r\n            configurable: true,\r\n        });\r\n    };\r\n}\r\n/**\r\n * `localStorage` Decorator\r\n *\r\n * @param [expiredAt=0] Expiration time, 0 means forever\r\n * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])\r\n */\r\nfunction LocalStorage(key, expiredAt, expiredUnit) {\r\n    if (expiredAt === void 0) { expiredAt = 0; }\r\n    if (expiredUnit === void 0) { expiredUnit = 't'; }\r\n    return WebStorage(isBrowser ? localStorage : null, key, expiredAt, expiredUnit);\r\n}\r\n/**\r\n * `sessionStorage` Decorator\r\n *\r\n * @param [expiredAt=0] Expiration time, 0 means forever\r\n * @param [expiredUnit='t'] Expiration time unit (default: custom [unit: ms])\r\n */\r\nfunction SessionStorage(key, expiredAt, expiredUnit) {\r\n    if (expiredAt === void 0) { expiredAt = 0; }\r\n    if (expiredUnit === void 0) { expiredUnit = 't'; }\r\n    return WebStorage(isBrowser ? sessionStorage : null, key, expiredAt, expiredUnit);\r\n}\r\n\r\nvar __extends = (this && this.__extends) || (function () {\r\n    var extendStatics = function (d, b) {\r\n        extendStatics = Object.setPrototypeOf ||\r\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\r\n            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };\r\n        return extendStatics(d, b);\r\n    };\r\n    return function (d, b) {\r\n        extendStatics(d, b);\r\n        function __() { this.constructor = d; }\r\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\r\n    };\r\n})();\r\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar __metadata = (this && this.__metadata) || function (k, v) {\r\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\r\n};\r\nvar StorageService = /** @class */ (function () {\r\n    function StorageService(storage) {\r\n        this.storage = storage;\r\n    }\r\n    StorageService.prototype.get = function (key) {\r\n        return StorageUtil.get(this.storage, key);\r\n    };\r\n    StorageService.prototype.set = function (key, value, expiredAt, expiredUnit) {\r\n        if (expiredAt === void 0) { expiredAt = 0; }\r\n        if (expiredUnit === void 0) { expiredUnit = 'd'; }\r\n        return StorageUtil.set(this.storage, key, value, expiredAt, expiredUnit);\r\n    };\r\n    /**\r\n     * 删除指定key，如：\r\n     * - `remove('key')` 删除 `key` 键\r\n     * - `remove(/BMap_\\w+/)` 批量删除所有 BMap_ 开头的键\r\n     * @param key 键名或正则表达式\r\n     */\r\n    StorageService.prototype.remove = function (key) {\r\n        var _this = this;\r\n        if (typeof key === 'string') {\r\n            StorageUtil.remove(this.storage, key);\r\n            return;\r\n        }\r\n        var index = 0;\r\n        var next = StorageUtil.key(this.storage, index);\r\n        var ls = [];\r\n        while (next) {\r\n            if (key.test(next))\r\n                ls.push(next);\r\n            next = StorageUtil.key(this.storage, ++index);\r\n        }\r\n        ls.forEach(function (v) { return StorageUtil.remove(_this.storage, v); });\r\n    };\r\n    StorageService.prototype.clear = function () {\r\n        this.storage.clear();\r\n    };\r\n    return StorageService;\r\n}());\r\nvar LocalStorageService = /** @class */ (function (_super) {\r\n    __extends(LocalStorageService, _super);\r\n    function LocalStorageService() {\r\n        return _super.call(this, isBrowser ? localStorage : null) || this;\r\n    }\r\n    LocalStorageService.ngInjectableDef = defineInjectable({ factory: function LocalStorageService_Factory() { return new LocalStorageService(); }, token: LocalStorageService, providedIn: \"root\" });\r\n    LocalStorageService = __decorate([\r\n        Injectable({ providedIn: 'root' }),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], LocalStorageService);\r\n    return LocalStorageService;\r\n}(StorageService));\r\nvar SessionStorageService = /** @class */ (function (_super) {\r\n    __extends(SessionStorageService, _super);\r\n    function SessionStorageService() {\r\n        return _super.call(this, isBrowser ? sessionStorage : null) || this;\r\n    }\r\n    SessionStorageService.ngInjectableDef = defineInjectable({ factory: function SessionStorageService_Factory() { return new SessionStorageService(); }, token: SessionStorageService, providedIn: \"root\" });\r\n    SessionStorageService = __decorate([\r\n        Injectable({ providedIn: 'root' }),\r\n        __metadata(\"design:paramtypes\", [])\r\n    ], SessionStorageService);\r\n    return SessionStorageService;\r\n}(StorageService));\r\n\r\nvar __decorate$1 = (this && this.__decorate) || function (decorators, target, key, desc) {\r\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\r\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\r\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\r\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\r\n};\r\nvar AngularWebStorageModule = /** @class */ (function () {\r\n    function AngularWebStorageModule() {\r\n    }\r\n    AngularWebStorageModule = __decorate$1([\r\n        NgModule()\r\n    ], AngularWebStorageModule);\r\n    return AngularWebStorageModule;\r\n}());\r\n\r\n/**\r\n * Generated bundle index. Do not edit.\r\n */\r\n\r\nexport { AngularWebStorageModule, LocalStorage, LocalStorageService, SessionStorage, SessionStorageService, StorageService };\r\n\r\n"]}